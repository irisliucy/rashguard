<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JOP Order ‚Äî All Heart, All In</title>

  <style>
    :root { --ink:#111; --muted:#666; --line:#eaeaea; --bg:#fff; }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height:1.45;
    }
    .wrap{ max-width: 860px; margin: 0 auto; padding: 56px 16px 80px; }
    h1{ margin:0 0 8px; font-size: clamp(26px, 3.5vw, 40px); }
    .sub{ margin: 0 0 18px; color: var(--muted); max-width: 70ch; }
    .note{
      border-top: 1px solid var(--line); border-bottom: 1px solid var(--line);
      padding: 12px 0; margin: 18px 0 22px; color:#333; font-size: 13px;
    }
    .grid{ display:grid; grid-template-columns: 1fr; gap: 14px; }
    .card{ border:1px solid var(--line); border-radius: 14px; padding: 16px; }
    .row{ display:flex; gap: 12px; flex-wrap: wrap; }
    .col{ flex: 1 1 240px; }
    label{ display:block; font-weight: 650; margin: 10px 0 6px; font-size: 13px; color:#222; }
    .required{ color: #d32f2f; margin-left: 2px; }
    input[type="text"], input[type="email"], textarea, select, input[type="tel"]{
      width:100%; box-sizing:border-box;
      padding: 10px 12px; border:1px solid #d9d9d9; border-radius: 12px;
      font-size: 14px; outline: none; background:#fff;
    }
    input:invalid{
      border-color: #d32f2f;
    }
    input:valid{
      border-color: #0a7a2f;
    }
    textarea{ resize: vertical; }
    table{ width:100%; border-collapse: collapse; margin-top: 10px; }
    th, td{ padding: 10px 8px; border-top:1px solid var(--line); text-align:left; }
    th{ font-size: 12px; color: var(--muted); font-weight: 700; letter-spacing: .02em; }
    .qty{
      width: 96px; padding: 8px 10px; border-radius: 12px; border: 1px solid #d9d9d9;
      font-size: 14px;
    }
    .muted{ color: var(--muted); font-size: 12px; }
    .totalRow{
      display:flex; justify-content: space-between; align-items: baseline;
      border-top:1px solid var(--line); padding-top: 14px; margin-top: 14px;
    }
    .totalLabel{ color: var(--muted); font-size: 12px; letter-spacing: .12em; text-transform: uppercase; }
    .total{ font-size: 22px; font-weight: 850; }
    .btns{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
    button{
      border-radius: 999px; padding: 10px 14px; font-weight: 750;
      border: 1px solid #d9d9d9; background:#fff; cursor:pointer;
    }
    button.primary{ background:#111; border-color:#111; color:#fff; }
    .ok{ display:none; color:#0a7a2f; font-weight: 700; font-size: 13px; align-self:center; }
    .footer{ margin-top: 18px; color: var(--muted); font-size: 12px; }
    .pill{
      display:inline-block; padding: 2px 10px; border:1px solid var(--line);
      border-radius: 999px; font-size: 12px; color:#444; margin-left: 8px;
    }
    .story{
      margin: 24px 0; padding: 20px; background: #f9f9f9; border-radius: 14px;
      line-height: 1.6; color: #333;
    }
    .story p{ margin: 0 0 14px; }
    .story p:last-child{ margin-bottom: 0; }
    .products{ display: grid; grid-template-columns: 1fr; gap: 30px; margin: 32px 0; max-width: 500px; margin-left: auto; margin-right: auto; }
    .product{ text-align: center; }
    .product img{ 
      width: 100%; 
      height: auto; 
      max-height: 500px;
      object-fit: contain; 
      border-radius: 12px; 
      border: 1px solid var(--line); 
    }
    .product h3{ margin: 16px 0 6px; font-size: 18px; font-weight: 700; }
    .product .price{ color: var(--muted); font-size: 20px; font-weight: 650; }

    /* Responsive Design for Mobile, Tablet, and Desktop */
    @media (max-width: 768px) {
      .wrap{ padding: 32px 16px 60px; }
      h1{ font-size: clamp(22px, 5vw, 32px); }
      .story{ padding: 16px; font-size: 14px; }
      .card{ padding: 14px; }
      .products{ max-width: 100%; margin: 24px 0; }
      .product img{ max-height: 400px; }
      .product h3{ font-size: 16px; }
      .product .price{ font-size: 18px; }
      .note{ font-size: 12px; padding: 10px 0; }
      .pill{ font-size: 11px; padding: 2px 8px; margin-left: 6px; margin-top: 4px; }
      .row{ flex-direction: column; }
      .col{ flex: 1 1 100%; }
      table{ font-size: 14px; }
      th, td{ padding: 8px 6px; }
      .qty{ width: 80px; font-size: 14px; }
      button{ padding: 12px 18px; font-size: 15px; min-height: 44px; }
      .btns{ gap: 8px; }
      .total{ font-size: 20px; }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      /* Tablet styles */
      .wrap{ padding: 48px 24px 70px; }
      .products{ max-width: 600px; }
      .product img{ max-height: 550px; }
      .col{ flex: 1 1 280px; }
    }

    @media (min-width: 1025px) {
      /* Desktop - images can be side by side if desired */
      .products{ 
        grid-template-columns: repeat(2, 1fr); 
        max-width: 100%;
        gap: 40px;
      }
      .product img{ max-height: 500px; }
    }

    /* Custom Modal Popup */
    .modal-overlay{
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .modal-overlay.show{ display: flex; }
    .modal{
      background: white;
      border-radius: 16px;
      padding: 32px 24px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      text-align: center;
      animation: slideUp 0.3s ease-out;
    }
    @keyframes slideUp{
      from{ transform: translateY(20px); opacity: 0; }
      to{ transform: translateY(0); opacity: 1; }
    }
    .modal h2{
      margin: 0 0 12px;
      font-size: 24px;
      color: #0a7a2f;
    }
    .modal p{
      margin: 0 0 24px;
      color: #333;
      line-height: 1.5;
      font-size: 16px;
    }
    .modal button{
      width: 100%;
      max-width: 200px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 999px;
      background: #0a7a2f;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    .modal button:hover{
      background: #086324;
    }
    
    /* Animations for success/cancel banners */
    @keyframes slideDown {
      from {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    @keyframes slideUp {
      from {
        transform: translate(-50%, 0);
        opacity: 1;
      }
      to {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
    }
    
    @media (max-width: 768px) {
      .modal{
        padding: 24px 20px;
        margin: 16px;
      }
      .modal h2{ font-size: 20px; }
      .modal p{ font-size: 15px; }
      .modal button{
        max-width: 100%;
        min-height: 44px;
      }
    }

    /* Payment Selection Modal */
    .payment-modal{
      max-width: 600px;
      text-align: center;
    }
    .payment-modal h2{
      color: #111;
      margin-bottom: 8px;
    }
    .payment-total{
      font-size: 32px;
      font-weight: 800;
      color: #0a7a2f;
      margin: 16px 0 24px;
    }
    .payment-options{
      display: grid;
      gap: 12px;
      margin-bottom: 20px;
      max-width: 450px;
      margin-left: auto;
      margin-right: auto;
    }
    .payment-btn{
      width: 100%;
      padding: 16px 24px;
      border-radius: 12px;
      border: 2px solid #d9d9d9;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 700;
      text-align: center;
    }
    .payment-btn:hover{
      border-color: #0a7a2f;
      background: #f0fdf4;
    }
    .payment-btn.stripe{
      background: #635bff;
      border-color: #635bff;
      color: white;
    }
    .payment-btn.stripe:hover{
      background: #5348e6;
      border-color: #5348e6;
    }
    .payment-btn.venmo{
      background: #008CFF;
      border-color: #008CFF;
      color: white;
    }
    .payment-btn.venmo:hover{
      background: #0077d6;
      border-color: #0077d6;
    }
    .payment-instructions{
      background: #f9fafb;
      padding: 16px;
      border-radius: 12px;
      text-align: left;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 16px;
      display: none;
    }
    .payment-instructions.show{
      display: block;
    }
    .payment-instructions strong{
      color: #111;
      font-size: 15px;
    }
    .copy-btn-small{
      display: inline-block;
      padding: 4px 12px;
      background: #0a7a2f;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 8px;
    }
    .copy-btn-small:hover{
      background: #086324;
    }
  </style>
</head>

<body>
  <main class="wrap">
    <h1>"All Heart All In" x JOP Rashguard Kit Pre-Order</h1>

    <div class="story">
      <p><strong>"All Heart, All In"</strong> is a motto I live by - on and off the mat.</p>
      <p>In every competition, I strive to give everything I have: courage, heart, relentlessness and fearlessness. You have to show up fully in every match, because nothing is guaranteed, not even a second one.</p>
      <p>In collaboration with <a href="https://jop-studio.com/" target="_blank" style="color: #0284c7; text-decoration: underline; font-weight: 600;">JOP Studio</a>, this kit is built for performance and made to stand out. Shine in this bright red kit!</p>
      <p><strong>15% of ALL SALES will be donated to <a href="https://www.tapcancerout.org/" target="_blank" style="color: #0284c7; text-decoration: underline; font-weight: 600;">TapCancerOut.Org</a> to combat cancer.</strong></p>
    </div>

    <div class="products">
      <div class="product">
        <img src="rashguard-image.png" alt="All Heart All In Rashguard" style="max-height: 600px;" />
        <h3>"All Heart All In" Rashguard</h3>
        <div class="price">$60</div>
      </div>
      <div class="product">
        <img src="shorts-image.png" alt="All Heart All In Shorts" />
        <h3>"All Heart All In" Shorts</h3>
        <div class="price">$50</div>
      </div>
    </div>

    <div class="note">
      <strong>15% of all sales</strong> will be donated to <a href="https://www.tapcancerout.org/" target="_blank" style="color: #0284c7; text-decoration: underline;">Tap Cancer Out</a> to combat cancer.
      <span class="pill">Rashguard $60</span>
      <span class="pill">Shorts $50</span>
    </div>

    <div class="grid">
      <!-- Customer -->
      <section class="card">
        <h2 style="margin:0 0 6px; font-size: 18px;">Your info</h2>
        <div class="row">
          <div class="col">
            <label for="name">Name<span class="required">*</span></label>
            <input id="name" type="text" placeholder="Your name" required />
          </div>
          <div class="col">
            <label for="email">Email<span class="required">*</span></label>
            <input id="email" type="email" placeholder="you@email.com" required />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="phone">Phone number<span class="required">*</span></label>
            <input id="phone" type="tel" placeholder="(123) 456-7890" required />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="handle">IG handle (optional)</label>
            <input id="handle" type="text" placeholder="@username" />
          </div>
        </div>

        <h3 style="margin: 20px 0 12px; font-size: 16px; font-weight: 700;">Shipping Address</h3>
        
        <label for="street">Street Address<span class="required">*</span></label>
        <input id="street" type="text" placeholder="123 Main Street, Apt 4B" required />

        <div class="row">
          <div class="col">
            <label for="city">City<span class="required">*</span></label>
            <input id="city" type="text" placeholder="Los Angeles" required />
          </div>
          <div class="col">
            <label for="state">State<span class="required">*</span></label>
            <input id="state" type="text" placeholder="CA" required />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="zipcode">Zip Code<span class="required">*</span></label>
            <input id="zipcode" type="text" placeholder="90001" required />
          </div>
          <div class="col">
            <label for="country">Country<span class="required">*</span></label>
            <input id="country" type="text" placeholder="United States" required />
          </div>
        </div>

        <div class="muted" style="margin-top:8px;">
          Orders are confirmed after payment. Questions: IG@irisliu.bjj ‚Ä¢ irisliu.0616@gmail.com
        </div>
      </section>

      <!-- Rashguard -->
      <section class="card">
        <p class="sub" style="margin-top: 0;">
          Enter quantities next to each size (default 0). You can order multiple sizes/items in one submission.
        </p>
        
        <h2 style="margin:0; font-size: 18px;">Rashguard quantities</h2>
        <div class="muted">Unisex sizing. Enter 0 if none.</div>

        <table>
          <thead>
            <tr><th>Size</th><th>Qty</th><th class="muted">Guide</th></tr>
          </thead>
          <tbody id="rashBody"></tbody>
        </table>
      </section>

      <!-- Shorts -->
      <section class="card">
        <h2 style="margin:0; font-size: 18px;">Shorts quantities</h2>
        <div class="muted">Unisex sizing. Enter 0 if none.</div>

        <table>
          <thead>
            <tr><th>Size</th><th>Qty</th><th class="muted">Guide</th></tr>
          </thead>
          <tbody id="shortBody"></tbody>
        </table>
      </section>

      <!-- Summary -->
      <section class="card">
        <div class="totalRow">
          <div>
            <div class="totalLabel">Total</div>
            <div class="muted">Calculated automatically</div>
          </div>
          <div class="total">$<span id="total">0</span></div>
        </div>

        <div class="btns">
          <button class="primary" type="button" id="submitBtn">Submit & Pay</button>
          <button type="button" id="copyBtn">Copy summary</button>
          <button type="button" id="resetBtn">Reset</button>
          <span id="ok" class="ok">Copied!</span>
        </div>

        <div id="formLink" style="display:none; margin-top: 16px; padding: 14px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 12px;">
          <strong style="color: #0369a1;">Popup blocked?</strong> 
          <a id="formUrl" href="#" target="_blank" style="color: #0284c7; text-decoration: underline; font-weight: 600;">Click here to open the Google Form</a>
        </div>

        <label for="summary">Order summary</label>
        <textarea id="summary" rows="8" readonly></textarea>

        <div class="footer">
          "Submit order" opens a Google Form prefilled with this info. Click "Submit" in google form to confirm your order.
        </div>
      </section>
    </div>
  </main>

  <!-- Custom Modal -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal">
      <h2>‚úì Order Confirmed!</h2>
      <p>Thank you for your order! We've received your information and will be in touch shortly.</p>
      <p style="font-size: 14px; color: #666;">A confirmation email will be sent to you soon.</p>
      <button id="modalOk">Got it!</button>
    </div>
  </div>

  <!-- Payment Modal -->
  <div id="paymentModal" class="modal-overlay">
    <div class="modal payment-modal">
      <h2>Complete Your Payment</h2>
      <div class="payment-total">$<span id="paymentTotal">0</span></div>
      <div style="color: #666; font-size: 14px; margin-bottom: 4px;">
        Please pay this exact amount
      </div>
      <div id="orderRecap" style="color: #888; font-size: 12px; margin-bottom: 20px; line-height: 1.5;">
        <!-- Order items will be displayed here -->
      </div>
      
      <div class="payment-options">
        <button class="payment-btn stripe" id="stripeBtn">
          üí≥ Pay with Credit Card (Secure via Stripe)
        </button>
        <button class="payment-btn venmo" id="venmoBtn">
          üí∞ Pay with Venmo
        </button>
        <button class="payment-btn" id="zelleBtn">
          üè¶ Pay with Zelle
        </button>
      </div>

      <div class="muted" style="margin-top: 12px; font-size: 13px;">
        For Venmo/Zelle: Payment instructions will be emailed to you immediately.
      </div>

      <!-- Venmo Instructions -->
      <div id="venmoInstructions" class="payment-instructions">
        <strong>‚úì Order Submitted!</strong><br>
        <p style="margin: 12px 0;">Check your email for Venmo payment instructions.</p>
        <p style="margin: 8px 0; font-size: 13px; color: #666;">We've sent payment details to: <strong id="customerEmailVenmo"></strong></p>
      </div>

      <!-- Zelle Instructions -->
      <div id="zelleInstructions" class="payment-instructions">
        <strong>‚úì Order Submitted!</strong><br>
        <p style="margin: 12px 0;">Check your email for Zelle payment instructions.</p>
        <p style="margin: 8px 0; font-size: 13px; color: #666;">We've sent payment details to: <strong id="customerEmailZelle"></strong></p>
      </div>

      <button id="closePaymentBtn" style="display:none; margin-top: 20px; width: 100%; padding: 14px; background: #0a7a2f; color: white; border: none; border-radius: 999px; font-weight: 700; font-size: 16px; cursor: pointer;">
        Close
      </button>

      <button id="cancelPaymentBtn" style="margin-top: 12px; background: transparent; color: #666; border: none; cursor: pointer; font-size: 14px;">
        Cancel
      </button>
    </div>
  </div>

  <script>
    // =======================
    // CONFIG YOU EDIT
    // =======================
    const PRICES = { rashguard: 60, shorts: 50 };

    // VENMO & ZELLE INFO
    const VENMO_HANDLE = "@irisliucy";
    const ZELLE_EMAIL = "irisliu.0616@gmail.com";

    // GOOGLE APPS SCRIPT WEB APP URL - You'll add this after deploying the script
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzr5y5YjVjJBeAAdPfXvbhQUsymX5iCUs3jFC0K5s8g8rt6zNwIZ0oKa3vWuKJYSu9F/exec";

    // =======================
    // DATA
    // =======================
    const RASH_SIZES = [
      { size: "2XS", guide: "90‚Äì105 lbs" },
      { size: "XS",  guide: "105‚Äì125 lbs" },
      { size: "S",   guide: "125‚Äì145 lbs" },
      { size: "M",   guide: "145‚Äì165 lbs" },
      { size: "L",   guide: "165‚Äì185 lbs" },
      { size: "XL",  guide: "185‚Äì205 lbs" },
      { size: "XXL", guide: "205‚Äì230 lbs" },
    ];
    const SHORT_SIZES = [
      { size: "2XS", guide: "~24\" waist" },
      { size: "XS",  guide: "24\"‚Äì26\" waist" },
      { size: "S",   guide: "26\"‚Äì28\" waist" },
      { size: "M",   guide: "28\"‚Äì30\" waist" },
      { size: "L",   guide: "30\"‚Äì32\" waist" },
      { size: "XL",  guide: "32\"‚Äì34\" waist" },
      { size: "2XL", guide: "34\"‚Äì36\" waist" },
    ];

    const el = (id) => document.getElementById(id);

    function buildQtyRow(size, key, extraText) {
      const tr = document.createElement("tr");

      const tdSize = document.createElement("td");
      tdSize.textContent = size;

      const tdQty = document.createElement("td");
      const inp = document.createElement("input");
      inp.type = "number";
      inp.min = "0";
      inp.step = "1";
      inp.value = "0";
      inp.className = "qty";
      inp.dataset.key = key;
      inp.dataset.size = size;
      inp.addEventListener("input", () => {
        let v = parseInt(inp.value || "0", 10);
        if (Number.isNaN(v) || v < 0) v = 0;
        inp.value = String(v);
        update();
      });
      tdQty.appendChild(inp);

      tr.appendChild(tdSize);
      tr.appendChild(tdQty);

      if (extraText !== undefined) {
        const tdExtra = document.createElement("td");
        tdExtra.className = "muted";
        tdExtra.textContent = extraText;
        tr.appendChild(tdExtra);
      }

      return tr;
    }

    function renderTables() {
      const rashBody = el("rashBody");
      rashBody.innerHTML = "";
      for (const r of RASH_SIZES) {
        rashBody.appendChild(buildQtyRow(r.size, "rashguard", r.guide));
      }

      const shortBody = el("shortBody");
      shortBody.innerHTML = "";
      for (const s of SHORT_SIZES) {
        shortBody.appendChild(buildQtyRow(s.size, "shorts", s.guide));
      }
    }

    function getQtyMap() {
      const items = { rashguard: {}, shorts: {} };
      const inputs = Array.from(document.querySelectorAll("input.qty"));
      for (const inp of inputs) {
        const key = inp.dataset.key;
        const size = inp.dataset.size;
        const qty = parseInt(inp.value || "0", 10) || 0;
        if (qty > 0) items[key][size] = qty;
      }
      return items;
    }

    function calcTotal(items) {
      const rashQty = Object.values(items.rashguard).reduce((a,b)=>a+b,0);
      const shortQty = Object.values(items.shorts).reduce((a,b)=>a+b,0);
      return rashQty * PRICES.rashguard + shortQty * PRICES.shorts;
    }

    function formatLine(label, map) {
      const entries = Object.entries(map);
      if (entries.length === 0) return `${label}: (none)`;
      return `${label}: ` + entries.map(([size, qty]) => `${size} x${qty}`).join(", ");
    }

    function buildOrderSummary(items, total) {
      // Summary for Google Form (order details only, no user info)
      const lines = [];
      lines.push(formatLine("Rashguard ($60)", items.rashguard));
      lines.push(formatLine("Shorts ($50)", items.shorts));
      lines.push("");
      lines.push(`Total: $${total}`);
      const donation = (total * 0.15).toFixed(2);
      lines.push(`Donation (15%): $${donation} to TapCancerOut.org`);
      return lines.join("\n");
    }

    function buildSummary(items, total) {
      const lines = [];
      lines.push("All Heart, All In ‚Äî Order Summary");
      lines.push("--------------------------------");
      const name = el("name").value.trim();
      const email = el("email").value.trim();
      const phone = el("phone").value.trim();
      const handle = el("handle").value.trim();
      const street = el("street").value.trim();
      const city = el("city").value.trim();
      const state = el("state").value.trim();
      const zipcode = el("zipcode").value.trim();
      const country = el("country").value.trim();

      if (name) lines.push(`Name: ${name}`);
      if (email) lines.push(`Email: ${email}`);
      if (phone) lines.push(`Phone: ${phone}`);
      if (handle) lines.push(`IG: ${handle}`);
      
      if (street || city || state || zipcode || country) {
        lines.push(`Shipping: ${street}, ${city}, ${state} ${zipcode}, ${country}`);
      }
      lines.push("");
      lines.push(formatLine("Rashguard ($60)", items.rashguard));
      lines.push(formatLine("Shorts ($50)", items.shorts));
      lines.push("");
      lines.push(`Total: $${total}`);
      
      const donation = (total * 0.15).toFixed(2);
      lines.push("");
      lines.push(`Thank you for your order. You have donated $${donation} to TapCancerOut.org`);
      return lines.join("\n");
    }

    function update() {
      const items = getQtyMap();
      const total = calcTotal(items);
      el("total").textContent = String(total);
      el("summary").value = buildSummary(items, total);
    }

    async function copySummary() {
      const text = el("summary").value;
      try {
        await navigator.clipboard.writeText(text);
      } catch {
        el("summary").focus();
        el("summary").select();
        document.execCommand("copy");
      }
      el("ok").style.display = "inline";
      setTimeout(() => el("ok").style.display = "none", 1200);
    }

    function resetAll() {
      el("name").value = "";
      el("email").value = "";
      el("phone").value = "";
      el("handle").value = "";
      document.getElementById("formLink").style.display = "none";
      el("street").value = "";
      el("city").value = "";
      el("state").value = "";
      el("zipcode").value = "";
      el("country").value = "";
      for (const inp of document.querySelectorAll("input.qty")) inp.value = "0";
      update();
    }

    function submitOrder() {
      const name = el("name").value.trim();
      const email = el("email").value.trim();
      const phone = el("phone").value.trim();
      const street = el("street").value.trim();
      const city = el("city").value.trim();
      const state = el("state").value.trim();
      const zipcode = el("zipcode").value.trim();
      const country = el("country").value.trim();
      
      if (!name) { alert("Please enter your name before submitting."); return; }
      if (!email) { alert("Please enter your email before submitting."); return; }
      if (!phone) { alert("Please enter your phone number before submitting."); return; }
      if (!street) { alert("Please enter your street address."); return; }
      if (!city) { alert("Please enter your city."); return; }
      if (!state) { alert("Please enter your state."); return; }
      if (!zipcode) { alert("Please enter your zip code."); return; }
      if (!country) { alert("Please enter your country."); return; }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert("Please enter a valid email address.");
        return;
      }

      const items = getQtyMap();
      const total = calcTotal(items);
      
      // Check if at least one item is ordered
      if (total === 0) {
        alert("Please select at least one item to order.");
        return;
      }

      const orderSummary = buildOrderSummary(items, total);
      
      const handle = el("handle").value.trim();

      // Store order data for later submission to Google Sheets
      window.pendingOrder = {
        name,
        email,
        phone,
        handle,
        street,
        city,
        state,
        zipcode,
        country,
        items,
        total,
        paymentStatus: 'Pending'
      };
      
      // Store customer email
      window.customerEmail = email;
      
      // Show payment modal
      showPaymentModal(total);
    }

    function showPaymentModal(total) {
      const paymentModal = document.getElementById("paymentModal");
      document.getElementById("paymentTotal").textContent = total;
      
      // Build order recap
      const items = getQtyMap();
      const recapItems = [];
      
      // Add rashguards
      Object.entries(items.rashguard).forEach(([size, qty]) => {
        if (qty > 0) {
          recapItems.push(`Rashguard ${size} x${qty}`);
        }
      });
      
      // Add shorts
      Object.entries(items.shorts).forEach(([size, qty]) => {
        if (qty > 0) {
          recapItems.push(`Shorts ${size} x${qty}`);
        }
      });
      
      // Display recap
      const recapText = recapItems.length > 0 ? recapItems.join(' ‚Ä¢ ') : 'No items';
      document.getElementById("orderRecap").textContent = recapText;
      
      paymentModal.classList.add("show");
    }

    async function submitOrderToGoogleSheets(paymentMethod) {
      if (GOOGLE_SCRIPT_URL.includes("YOUR_GOOGLE_APPS")) {
        alert("Google Sheets backend not configured yet. Please deploy the Google Apps Script.");
        return false;
      }

      try {
        // Make sure we have all the data
        if (!window.pendingOrder) {
          console.error('No pending order found');
          alert('Order data is missing. Please try again.');
          return false;
        }

        const orderData = {
          ...window.pendingOrder,
          payment: paymentMethod,
          paymentStatus: paymentMethod === 'Stripe' ? 'Paid' : 'Pending Payment'
        };

        console.log('Submitting order:', orderData);

        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', // Required for Google Apps Script
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(orderData)
        });

        console.log('Order submitted successfully');
        // no-cors mode means we can't read the response, but the request went through
        return true;
      } catch (error) {
        console.error('Error submitting order:', error);
        alert('Failed to submit order. Please try contacting us directly at irisliu.0616@gmail.com');
        return false;
      }
    }

    function showThankYouMessage() {
      document.getElementById("paymentModal").classList.remove("show");
      const modalOverlay = document.getElementById("modalOverlay");
      modalOverlay.classList.add("show");
    }

    // Stripe Payment Button
    document.getElementById("stripeBtn").addEventListener("click", async () => {
      const btn = document.getElementById("stripeBtn");
      const originalText = btn.textContent;
      btn.textContent = "Creating checkout...";
      btn.disabled = true;
      
      try {
        console.log('Sending request to:', GOOGLE_SCRIPT_URL);
        console.log('Order data:', window.pendingOrder);
        
        // Create Stripe checkout session via our backend
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          headers: { 
            'Content-Type': 'text/plain;charset=utf-8'
          },
          body: JSON.stringify({
            action: 'create_stripe_session',
            ...window.pendingOrder
          })
        });
        
        console.log('Response status:', response.status);
        console.log('Response ok:', response.ok);
        
        // Try to parse the response
        const resultText = await response.text();
        console.log('Response text:', resultText);
        
        const result = JSON.parse(resultText);
        console.log('Parsed result:', result);
        
        if (result.status === 'success' && result.url) {
          // Record the order as pending before redirecting
          await submitOrderToGoogleSheets('Stripe');
          
          // Redirect to Stripe Checkout
          window.location.href = result.url;
        } else {
          throw new Error(result.message || 'Failed to create checkout session');
        }
      } catch (error) {
        console.error('Stripe error:', error);
        
        // Show detailed error message
        let errorMsg = 'Error creating payment session:\n\n';
        errorMsg += error.message + '\n\n';
        errorMsg += 'Troubleshooting steps:\n';
        errorMsg += '1. Check Apps Script deployment (Extensions > Apps Script > Deploy)\n';
        errorMsg += '2. Ensure "Who has access" is set to "Anyone"\n';
        errorMsg += '3. Ensure "Execute as" is set to "Me"\n';
        errorMsg += '4. Add your Stripe API key to the script\n';
        errorMsg += '5. Check browser console (F12) for more details';
        
        alert(errorMsg);
        btn.textContent = originalText;
        btn.disabled = false;
      }
    });

    // Venmo Payment Button
    document.getElementById("venmoBtn").addEventListener("click", async () => {
      const btn = document.getElementById("venmoBtn");
      btn.textContent = "Submitting...";
      btn.disabled = true;
      
      // Submit order to Google Sheets (this triggers email)
      const success = await submitOrderToGoogleSheets('Venmo');
      
      if (success) {
        // Show instructions with customer email
        document.getElementById("customerEmailVenmo").textContent = window.customerEmail;
        document.getElementById("venmoInstructions").classList.add("show");
        document.getElementById("zelleInstructions").classList.remove("show");
        document.getElementById("closePaymentBtn").style.display = "block";
      }
      
      btn.textContent = "üí∞ Pay with Venmo";
      btn.disabled = false;
    });

    // Zelle Payment Button
    document.getElementById("zelleBtn").addEventListener("click", async () => {
      const btn = document.getElementById("zelleBtn");
      btn.textContent = "Submitting...";
      btn.disabled = true;
      
      // Submit order to Google Sheets (this triggers email)
      const success = await submitOrderToGoogleSheets('Zelle');
      
      if (success) {
        // Show instructions with customer email
        document.getElementById("customerEmailZelle").textContent = window.customerEmail;
        document.getElementById("zelleInstructions").classList.add("show");
        document.getElementById("venmoInstructions").classList.remove("show");
        document.getElementById("closePaymentBtn").style.display = "block";
      }
      
      btn.textContent = "üè¶ Pay with Zelle";
      btn.disabled = false;
    });

    // Close Payment Button
    document.getElementById("closePaymentBtn").addEventListener("click", () => {
      showThankYouMessage();
    });

    // Cancel Payment Button
    document.getElementById("cancelPaymentBtn").addEventListener("click", () => {
      document.getElementById("paymentModal").classList.remove("show");
      document.getElementById("venmoInstructions").classList.remove("show");
      document.getElementById("zelleInstructions").classList.remove("show");
      document.getElementById("closePaymentBtn").style.display = "none";
    });

    // Close modal when clicking OK button
    document.getElementById("modalOk").addEventListener("click", () => {
      document.getElementById("modalOverlay").classList.remove("show");
    });

    // Close modal when clicking outside
    document.getElementById("modalOverlay").addEventListener("click", (e) => {
      if (e.target.id === "modalOverlay") {
        document.getElementById("modalOverlay").classList.remove("show");
      }
    });

    // Wire up
    renderTables();
    update();

    // Check for payment success/cancel in URL
    const urlParams = new URLSearchParams(window.location.search);
    const paymentStatus = urlParams.get('payment');
    
    if (paymentStatus === 'success') {
      setTimeout(() => {
        // Show custom success message
        const successBanner = document.createElement('div');
        successBanner.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: #dc2626;
          color: white;
          padding: 20px 40px;
          border-radius: 12px;
          font-size: 24px;
          font-weight: bold;
          box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
          z-index: 10000;
          text-align: center;
          animation: slideDown 0.5s ease-out;
        `;
        successBanner.textContent = '‚úÖ Success! Thank you for your order!';
        document.body.appendChild(successBanner);
        
        // Also show the detailed modal after a moment
        setTimeout(() => {
          showSuccessModal();
        }, 1500);
        
        // Remove banner after 5 seconds
        setTimeout(() => {
          successBanner.style.animation = 'slideUp 0.5s ease-out';
          setTimeout(() => successBanner.remove(), 500);
        }, 5000);
        
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }, 500);
    } else if (paymentStatus === 'cancelled') {
      setTimeout(() => {
        // Show custom cancel message
        const cancelBanner = document.createElement('div');
        cancelBanner.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: #dc2626;
          color: white;
          padding: 20px 40px;
          border-radius: 12px;
          font-size: 24px;
          font-weight: bold;
          box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
          z-index: 10000;
          text-align: center;
          animation: slideDown 0.5s ease-out;
        `;
        cancelBanner.textContent = '‚ùå Payment Cancelled';
        document.body.appendChild(cancelBanner);
        
        // Show detailed alert after banner
        setTimeout(() => {
          alert('Your payment was cancelled. If you have questions, please contact us at irisliu.bjj@gmail.com');
        }, 1500);
        
        // Remove banner after 5 seconds
        setTimeout(() => {
          cancelBanner.style.animation = 'slideUp 0.5s ease-out';
          setTimeout(() => cancelBanner.remove(), 500);
        }, 5000);
        
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }, 500);
    }

    ["name","email","phone","handle","street","city","state","zipcode","country"].forEach(id => {
      el(id).addEventListener("input", update);
      el(id).addEventListener("change", update);
    });

    el("copyBtn").addEventListener("click", copySummary);
    el("resetBtn").addEventListener("click", resetAll);
    el("submitBtn").addEventListener("click", submitOrder);
  </script>
</body>
</html>
